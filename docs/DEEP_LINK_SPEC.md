# Trackmate Timing App Deep Link Specification (v1)

This document describes the deep link contract between the Trackmate Web frontend and the Trackmate Timing native app.

## Version

**Current version: v=1**

All deep links generated by this frontend include `v=1`.

## Scheme

```
trackmate://
```

## Path

```
/timing
```

## Canonical URL Format

```
trackmate://timing?v=1&trackId=<uuid>&carId=<uuid>&conditions=<dry|damp|wet>
```

## Query Parameters

| Parameter    | Required | Type   | Description                              |
|--------------|----------|--------|------------------------------------------|
| `v`          | Yes      | string | Version number (always "1")              |
| `trackId`    | **Yes**  | UUID   | The track ID from the Trackmate database |
| `carId`      | No       | UUID   | The car ID from the user's garage        |
| `conditions` | No       | enum   | Track conditions (see values below)      |

### Conditions Values

- `dry` - Dry track surface
- `damp` - Damp track surface
- `wet` - Wet track surface

**Note:** The UI may display more specific options (e.g., "Dry â€“ sunny/warm"), but these are normalized to `dry`, `damp`, or `wet` when generating the deep link.

## URL Encoding

All parameter values **must** be URL-encoded using `encodeURIComponent()`.

## Examples

### Minimal (required params only)

```
trackmate://timing?v=1&trackId=5ce4cc34-502c-4a2d-b7ab-a1fdeb3c8b75
```

### With car

```
trackmate://timing?v=1&trackId=5ce4cc34-502c-4a2d-b7ab-a1fdeb3c8b75&carId=a1b2c3d4-e5f6-7890-abcd-ef1234567890
```

### Full (all params)

```
trackmate://timing?v=1&trackId=5ce4cc34-502c-4a2d-b7ab-a1fdeb3c8b75&carId=a1b2c3d4-e5f6-7890-abcd-ef1234567890&conditions=dry
```

## Native App Behavior

When the Trackmate Timing app receives this deep link:

1. **Cold start**: App launches and navigates to Timing screen with params pre-filled
2. **Warm start**: App comes to foreground and updates Timing screen with new params
3. **Not logged in**: App shows Auth screen, then navigates to Timing with preserved params after login
4. **Missing trackId**: App logs error and does not crash
5. **Invalid conditions**: App ignores the value (treats as undefined)

## Web Frontend Usage

The `/timing` page on the web frontend:

1. Lets user select track, car, and conditions
2. Builds the deep link using `buildTimingDeepLink()` from `@/lib/deeplinks`
3. Normalizes conditions using `normalizeConditions()` before passing to builder
4. Opens the native app via `window.location.href = deepLink`
5. Shows fallback UI if the app doesn't open within 1.2 seconds

## Helper Functions

```typescript
import { buildTimingDeepLink, normalizeConditions } from '@/lib/deeplinks';

// Build a deep link
const link = buildTimingDeepLink({
  trackId: 'abc-123',
  carId: 'def-456',
  conditions: normalizeConditions('dry_warm'), // => 'dry'
});
// => 'trackmate://timing?v=1&trackId=abc-123&carId=def-456&conditions=dry'
```
